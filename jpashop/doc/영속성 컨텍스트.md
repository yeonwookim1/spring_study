1. 영속성 컨텍스트

   - 애플리케이션 - DB 사이에서 객체를 보관하는 가상의 DB 역할
   - 버퍼링 / 캐시 위해서 

2. 엔티티의 생명주기

   - 비영속 상태

     - 객체만 생성하고 엔티티와 연걸 X

     - ```java
       TestSession testSession = new TestSession();
       EntityManager em = emf.createEntityManager();
       ```

   - 영속 상태

     - 객체를 생성하고 저장한 상태

     - 영속성 컨텍스트가 관리하는 엔티티(1차 캐시/쓰기 지연 저장소에 있는 상태)

     - ```java
       //영속상태
       em.persist(testSession);
       ```

   - 준영속 상태

     - 엔티티가 영속성 컨텍스트에서 분리

   - 삭제 상태

     - 엔티티 삭제

3. 영속성 컨텍스트의 장점

   1. 1차 캐시
      - 엔티티 조회시 1차 캐시에서 조회
      - 1차 캐시에 없을 시, DB에서 조회 (1차 캐시에 저장 후 반환)
      - EM은 트랜잭션 단위이기에 트랜잭션이 끝나면 1차 캐시도 지워짐
   2. 영속 엔티티의 동일성 보장
      - 호출 반복하여도 1차 캐시에 있는 같은 엔티티가 반환 (JPA 가 아닌 mybatis는 동일성 보장 X)
   3. 엔티티 등록 시, 쓰기 지연
      - 트랜잭션을 커밋하는 순간, 한번에 디비에 SQL을 보냄
      - 그 전까지 쓰기 지연 저장소에 모았다가 한번에 보냄(성능을 위해서)
   4. 엔티티 수정시, 변경 감지
      - 플러시 시점에 엔티티와 스냅샷을 비교하여 바뀐 엔티티가 있으면 디비에 반영

4. 플러시
   - 영속성 컨텍스트의 변경내용을 DB에 동기화
   - 변경 감지 / 모아놓은 쿼리 전송 / 

5. 필요에 따라 준영속 상태로 변경
   - 준영속 상태 : 1차 캐시랑 쓰기 지연 저장소에서 제거된 상태
   - detach : 특정 엔티티만 준영속 상태로 변경
   - clear : 1차 캐시 지우기, 영속성 콘텍스트 새로 만들어짐(테스트 확인용)